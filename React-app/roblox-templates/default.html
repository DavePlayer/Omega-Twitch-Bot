<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <title>Roblox Donation</title>
        <script
            src="https://cdn.socket.io/3.1.3/socket.io.min.js"
            integrity="sha384-cPwlPLvBTa3sKAgddT6krw0cJat7egBga3DJepJyrLl4Q9/5WLra3rrnMcyTyOnh"
            crossorigin="anonymous"
        ></script>
        <style>
            * {
                padding: 0;
                margin: 0;
            }

            .robuxImg {
                background-image: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzMCIgaGVpZ2h0PSIzMCI+PHBhdGggZD0iTTguMyAzLjdMMy42IDIxLjhsMTguMSA0LjYgNC42LTE4LjEtMTgtNC42em04IDEzLjZsLTMuNS0uOS45LTMuNSAzLjUuOS0uOSAzLjV6IiBmaWxsPSIjMzkzYjNkIi8+PC9zdmc+);
                background-position: 0 0;
                width: 30px;
                height: 30px;
                display: block;
            }
            body {
                max-width: 100%;
            }

            .container {
                width: 100%;
                display: flex;
                flex-wrap: wrap;
                justify-content: center;
                overflow: hidden;
                /* padding: 1em; */
                opacity: 0;
                transition: opacity 2s;
            }

            figure {
                width: 50%;
                display: block;
            }

            figure img {
                width: 100%;
                height: 100%;
                display: block;
                border-radius: 50%;
            }

            .info {
                width: 100%;
                display: flex;
                justify-content: center;
                align-items: center;
                padding: 5px;
            }

            .message {
                width: 100%;
                text-align: center;
            }
        </style>
    </head>

    <body>
        <div class="container">
            <figure>
                <img class="donateImage" src="" alt="roblox image png" />
            </figure>
            <div class="info">
                <p>
                    <span class="username"></span> donated
                    <span class="robuxAmount"></span>
                </p>
                <span class="robuxImg"></span>
            </div>
            <p class="message"></p>
        </div>
        <script>
            window.onload = () => {
                const updateDonateContent = (donation) => {
                    console.log("upodating data: ", donation);
                    const donateImageBox = document.querySelector(`.donateImage`);
                    const usernameBox = document.querySelector(`.username`);
                    const robuxAmountBox = document.querySelector(`.robuxAmount`);
                    const messageBox = document.querySelector(`.message`);
                    const container = document.querySelector(`.container`);
                    const robuxImg = document.querySelector(`.robuxImg`);

                    // update content
                    donateImageBox.src = donation.donateImageUrl;
                    usernameBox.innerText = donation.username;
                    robuxAmountBox.innerText = donation.robuxAmmount;
                    messageBox.innerText = donation.message;

                    // update colors
                    console.log("FONT SIZE: ", settings.fontSize);
                    usernameBox.style.color = settings.userNickColor;
                    robuxAmountBox.style.color = settings.robuxAmountColor;
                    messageBox.style.color = settings.messageColor;
                    container.style.color = settings.textColor;
                    container.style.fontSize = settings.fontSize + "px";
                    container.style.fontFamily = settings.fontFamily;
                    robuxImg.style.width = settings.fontSize + "px";
                    robuxImg.style.height = settings.fontSize + "px";
                    robuxImg.style.backgroundSize = settings.fontSize + "px";

                    document.querySelector(`.container`).style.opacity = 1;
                    setTimeout(() => {
                        document.querySelector(`.container`).style.opacity = 0;
                    }, donation.timeOut * 1000);
                };
                class Donation {
                    constructor(imageUrl, username, robuxAmmount, message, timeOut) {
                        this.donateImageUrl = imageUrl;
                        this.username = username;
                        this.robuxAmmount = robuxAmmount;
                        this.message = message;
                        this.timeOut = timeOut;
                    }
                }
                let donationQuerry = [
                    new Donation(
                        "https://tr.rbxcdn.com/da30f07724e81853eb1677a5e43c7c04/150/150/AvatarHeadshot/Png",
                        "mihalx",
                        69,
                        "nice"
                    ),
                ];
                let settings = {
                    userNickColor: "#750da8",
                    robuxAmmountColor: "#750da8",
                    messageColor: "#f00",
                };

                if (donationQuerry.length > 0) {
                    updateDonateContent(donationQuerry[0]);
                    donationQuerry.shift();
                }
                setInterval(() => {
                    if (donationQuerry.length > 0) {
                        updateDonateContent(donationQuerry[0]);
                        donationQuerry.shift();
                    }
                }, 1000);

                if (window.WebSocket) {
                    const socket = io("ws://127.0.0.1:8080");
                    socket.on("donate::donate", (donateData) => {
                        console.log(donateData);
                        if (donateData) {
                            donationQuerry = [
                                ...donationQuerry,
                                new Donation(
                                    donateData.donateImageUrl,
                                    donateData.userName,
                                    donateData.robuxAmmount,
                                    donateData.message,
                                    donateData.timeOut
                                ),
                            ];
                            // settings.donateImageUrl = donateData.donateImageUrl;
                            // settings.userName = donateData.userName;
                            // settings.robuxAmmount = donateData.robuxAmmount;
                            // settings.message = donateData.message;
                        }
                    });
                    socket.on("donate::appendSettings", (set) => {
                        console.log("appending settings", set);
                        settings = {
                            userNickColor: set.nicknameColor,
                            robuxAmountColor: set.donateAmountColor,
                            messageColor: set.messageColor,
                            textColor: set.textColor,
                            fontSize: set.fontSize,
                            fontFamily: set.fontFamily,
                        };
                    });
                }
            };
        </script>
    </body>
</html>
